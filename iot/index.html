<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <!-- è®“æ‰‹æ©Ÿå¯ä»¥æ­£ç¢ºç¸®æ”¾ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="text-gray-900 font-sans bg-gray-100 min-h-screen overflow-auto">

    <!-- é ‚éƒ¨å›ºå®šåˆ— -->
    <div class="w-full flex items-center justify-between px-2 py-1 bg-white shadow fixed top-0 left-0 z-50">

        <!-- å·¦ä¸Šè§’æŒ‰éˆ•ï¼šåœ¨å°è¢å¹•ç”¨ text-xs px-2 py-1ï¼Œmd ä»¥ä¸Šæ‰ç”¨ text-sm px-3 py-2 -->
        <a href="https://quiz.xnor-development.com/cloud" class="text-gray-600 bg-gray-100 text-xs px-2 py-1 rounded hover:bg-gray-200
              md:text-sm md:px-3 md:py-2">
            å¾€ TQCé›²ç«¯æŠ€è¡“åŠç¶²è·¯æœå‹™
        </a>

        <!-- å³ä¸Šè§’åå­—ï¼šåŒç†ï¼Œå°è¢å¹• text-xsï¼Œmd ä»¥ä¸Š text-sm -->
        <div class="text-xs text-gray-600 md:text-sm">
            xnor-development.com Â©
        </div>

    </div>


    <!-- ä¸»å…§å®¹ï¼Œç•™ä¸Šæ–¹ç©ºé–“ pt-16 é¿å…è¢«å›ºå®šåˆ—æ“‹ä½ -->
    <div class="pt-16 min-h-screen flex flex-col justify-center items-center px-4 box-border">
        <!-- ä¸»è¦å®¹å™¨ï¼šmax-w-2xl + w-fullï¼Œèƒ½åœ¨å°è¢å¹•è‡ªå‹•ç¸®æ”¾ -->
        <div id="app" class="question-card bg-white p-6 rounded-lg shadow-lg max-w-2xl w-full">
            <!-- é€™è£¡æ”¾ä½ çš„ Vue ç¨‹å¼ç¢¼ã€æ¨¡æ¿ (ç…§åŸæ¨£) -->
            <div v-if="!sectionSelected" class="text-center">
                <img src="https://nic.tut.edu.tw/var/file/12/1012/pictures/684/m/mczh-tw400x400_small14858_202087529952.png"
                    alt="TQC ç‰©è¯ç¶²æ™ºæ…§æ‡‰ç”¨åŠæŠ€è¡“ ç¬¬2ç‰ˆ-å°ˆæ¥­ç´š" class="mb-4 mx-auto w-3/4">
                <p class="text-xl font-bold mb-4">TQC ç‰©è¯ç¶²æ™ºæ…§æ‡‰ç”¨åŠæŠ€è¡“ ç¬¬2ç‰ˆ-å°ˆæ¥­ç´š</p>
                <p class="text-xl font-bold mb-4">è«‹é¸æ“‡è¦é–‹å§‹çš„éƒ¨åˆ†</p>
                <p class="mb-4">æ¯éƒ¨åˆ†åŒ…å« 60 é¡Œï¼Œå…± 360 é¡Œ</p>

                <div class="grid grid-cols-3 gap-4 mb-4">
                    <button v-for="section in 6" :key="section" @click="changeSection(section)"
                        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                        ç¬¬ {{ section }} éƒ¨åˆ†
                    </button>
                </div>

                <div class="mt-4 flex items-center justify-center gap-4">
                    <!-- Toggle Switch -->
                    <label class="relative inline-flex items-center cursor-pointer">
                        <!-- éš±è—çš„ checkbox -->
                        <input type="checkbox" class="sr-only peer" v-model="shuffleQuestions">

                        <!-- å¤–å±¤è»Œé“ -->
                        <div class="w-9 h-5 bg-gray-200 rounded-full peer
                                 peer-checked:bg-blue-600
                                 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300
                                 relative
                                 md:w-11 md:h-6
                                 peer-checked:after:translate-x-full
                      
                                 after:content-[''] after:absolute after:top-[1px] after:left-[1px]
                                 after:bg-white after:border-gray-300 after:border after:rounded-full
                                 after:h-4 after:w-4 md:after:h-6 md:after:w-6
                                 after:transition-all">
                        </div>

                        <!-- æ–‡å­— -->
                        <span class="ml-2 text-sm md:text-base text-gray-900">
                            é¡Œç›®æ‰“äº‚é †åº
                        </span>
                    </label>


                    <!-- ä¸‹è¼‰ JSON æŒ‰éˆ• -->
                    <button @click="downloadJson" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                        ä¸‹è¼‰é¡Œåº« JSON æª”(360é¡Œ)
                    </button>
                </div>

                <div class="mt-6">
                    <input v-model="searchQuery" type="text" placeholder="è¼¸å…¥ 5 å€‹å­—ä»¥ä¸Šçš„é—œéµå­—"
                        class="px-4 py-2 border rounded w-2/3">
                    <p v-if="searchQuery.length > 0 && searchQuery.length < 5" class="text-red-500 text-sm mt-1">
                        è«‹è¼¸å…¥è‡³å°‘ 5 å€‹å­—
                    </p>
                    <button @click="searchQuestion"
                        class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 ml-2"
                        :disabled="searchQuery.length < 5">
                        æœå°‹é¡Œç›®
                    </button>
                </div>

                <div v-if="searchResults.length" class="mt-4 p-4 border rounded bg-gray-200 text-left">
                    <p class="font-bold">æœå°‹çµæœï¼š</p>
                    <div v-for="result in searchResults" :key="result.question_number" class="mb-4 p-2 border-b">
                        <p class="font-bold">é¡Œç›®ï¼š{{ result.question }}</p>
                        <ul>
                            <li v-for="(option, key) in result.options" :key="key">{{ key }}: {{ option }}</li>
                        </ul>
                        <p class="font-bold text-green-600">æ­£ç¢ºç­”æ¡ˆ: {{ result.correct_answer.join(', ') }}</p>
                    </div>
                </div>
            </div>

            <div v-else>
                <div class="text-center text-lg font-bold mb-4">ç›®å‰é€²è¡Œç¬¬ {{ currentQuestionIndex + 1 }} é¡Œï¼Œå…± {{
                    questions.length
                    }} é¡Œ</div>
                <div v-if="currentQuestion" class="relative">
                    <!-- å·çœ‹ç­”æ¡ˆæŒ‰éˆ• (å³ä¸Šè§’) -->
                    <button @mousedown="showAnswer = true" @mouseup="showAnswer = false"
                        @mouseleave="showAnswer = false" @touchstart="showAnswer = true" @touchend="showAnswer = false"
                        class="absolute top-0 right-0 px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600">
                        æŒ‰ä½å·çœ‹ç­”æ¡ˆ
                    </button>

                    <!-- é¡¯ç¤ºç­”æ¡ˆå€ -->
                    <div v-if="showAnswer" class="mt-2 text-red-600 font-bold">
                        æ­£ç¢ºç­”æ¡ˆï¼š{{ currentQuestion.correct_answer.join(', ') }}
                    </div>

                    <div class="text-lg font-bold mb-4">ç¬¬ {{ currentQuestion.question_number }} é¡Œ</div>
                    <div class="text-xl font-bold mb-4">{{ currentQuestion.question }}</div>

                    <form @submit.prevent="submitAnswer">
                        <div class="text-lg font-bold">
                            <label v-for="(option, key) in currentQuestion.options" :key="key" class="block mb-2">
                                <input type="checkbox" :value="key" v-model="selectedOptions" class="mr-2">
                                {{ key }}: {{ option }}
                            </label>
                        </div>
                        <div class="mt-4 flex justify-between">
                            <button type="button" @click="goBack"
                                class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">
                                ä¸Šä¸€é¡Œ
                            </button>

                            <button v-if="!answerSubmitted" type="submit"
                                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                                ç¢ºèªç­”æ¡ˆ
                            </button>
                            <button v-if="answerSubmitted" @click="nextQuestion"
                                class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                                ä¸‹ä¸€é¡Œ
                            </button>

                            <button type="button" @click="jumpToResult"
                                class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">
                                ç›´æ¥äº¤å·
                            </button>
                        </div>
                    </form>
                </div>

                <div v-else class="text-center">
                    <p class="text-green-600 font-bold">æ¸¬é©—çµæŸ!</p>
                    <p class="font-bold">ä½ çš„ç­”å°ç‡: {{ score }}/{{ questions.length }} é¡Œ</p>
                    <div v-if="wrongAnswers.length" class="mt-6 p-4 border rounded bg-gray-200 text-left w-full">
                        <p class="font-bold text-red-600 text-xl mb-4">éŒ¯èª¤é¡Œç›®ï¼š</p>

                        <div class="max-h-[600px] overflow-y-auto">
                            <div v-for="(wrong, index) in pagedWrongAnswers" :key="index"
                                class="mb-4 p-4 border-b text-base font-sans leading-relaxed">
                                <p class="font-bold text-gray-900">ç¬¬ {{ wrong.question_number }} é¡Œ</p>
                                <p class="font-bold text-gray-800">{{ wrong.question }}</p>
                                <ul class="mt-2">
                                    <li v-for="(option, key) in wrong.options" :key="key" class="ml-4">
                                        <span
                                            :class="{'text-red-500': wrong.selected.includes(key), 'text-green-600': wrong.correct.includes(key)}">
                                            {{ key }}: {{ option }}
                                        </span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="flex justify-between mt-4">
                            <button v-if="showPrevButton" @click="prevPage"
                                class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">
                                ä¸Šä¸€é 
                            </button>
                            <button v-if="showNextButton" @click="() => { 
                            console.log('â¡ï¸ [é»æ“Š] ä¸‹ä¸€é : ', currentPage.value);
                            nextPage(); 
                        }" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">
                                ä¸‹ä¸€é 
                            </button>



                        </div>
                    </div>




                    <button @click="restartExam"
                        class="mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">é‡æ–°é–‹å§‹æ¸¬é©—</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3"></script>
    <script>
        const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                const showAnswer = ref(false);

                const questions = ref([]);
                const currentQuestionIndex = ref(0);
                const currentQuestion = ref(null);
                const selectedOptions = ref([]);
                const showResult = ref(false);
                const isCorrect = ref(false);
                const score = ref(0);
                const sectionSize = 60;
                const currentSection = ref(1);
                const sectionSelected = ref(false);
                const searchQuery = ref("");
                const searchResult = ref(null);
                const searchResults = ref([]);

                // ğŸ”´ã€é‡è¦ã€‘æ”¹ç”¨ answers[] è¨˜éŒ„ã€Œæ¯é¡Œæœ€çµ‚é¸æ“‡ã€
                // ä¸è¦åœ¨ submitAnswer() æ™‚ push åˆ° wrongAnswersï¼
                const answers = ref([]); // answers.value[i] = ä½¿ç”¨è€…å°ç¬¬ i é¡Œçš„é¸æ“‡

                // åŸæœ¬å­˜éŒ¯èª¤é¡Œç›®çš„é™£åˆ—ï¼šæ”¹æˆã€Œçµç®—å¾Œã€æ‰å¡«å…¥
                const wrongAnswers = ref([]);

                const answerSubmitted = ref(false);

                // åˆ†é 
                const currentPage = ref(0);
                const itemsPerPage = 5;

                // ---------- è¼‰å…¥é¡Œåº« ----------
                // setup() å…§
                const shuffleQuestions = ref(false);
                function shuffleArray(arr) {
                    const array = [...arr];
                    for (let i = array.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [array[i], array[j]] = [array[j], array[i]];
                    }
                    return array;
                }

                async function loadQuestions() {
                    const response = await fetch('questions.json');
                    const allQuestions = await response.json();

                    let sectionQuestions = allQuestions.slice(
                        (currentSection.value - 1) * sectionSize,
                        currentSection.value * sectionSize
                    );

                    // è‹¥ä½¿ç”¨è€…å‹¾é¸ã€Œé¡Œç›®æ‰“äº‚é †åºã€
                    if (shuffleQuestions.value) {
                        sectionQuestions = shuffleArray(sectionQuestions);
                    }

                    questions.value = sectionQuestions;
                    currentQuestionIndex.value = 0;
                    currentQuestion.value = questions.value[0];
                }

                function changeSection(section) {
                    currentSection.value = section;
                    currentQuestionIndex.value = 0;
                    sectionSelected.value = true;
                    loadQuestions();
                }

                // ---------- ä½œç­”(ä¸å† push åˆ° wrongAnswers) ----------
                function submitAnswer() {
                    if (answerSubmitted.value) return;

                    // æª¢æŸ¥æ˜¯å¦æœ‰é¸æ“‡
                    if (selectedOptions.value.length === 0) {
                        alert("è«‹é¸æ“‡è‡³å°‘ä¸€å€‹é¸é …å†æäº¤ç­”æ¡ˆï¼");
                        return;
                    }

                    // è‹¥æ˜¯è¤‡é¸é¡Œ
                    const correctCount = currentQuestion.value.correct_answer.length;
                    if (correctCount > 1 && selectedOptions.value.length < 2) {
                        alert("æ­¤é¡Œç‚ºè¤‡é¸é¡Œï¼Œè«‹è‡³å°‘é¸æ“‡å…©å€‹é¸é …ï¼");
                        return;
                    }

                    answerSubmitted.value = true;
                    // å³æ™‚åˆ¤æ–·å°éŒ¯
                    const correctOptions = currentQuestion.value.correct_answer;
                    isCorrect.value = correctOptions.every(opt => selectedOptions.value.includes(opt)) &&
                        selectedOptions.value.every(opt => correctOptions.includes(opt));

                    // åŒæ­¥æ›´æ–° answers[]ï¼Œç¢ºä¿ä¸æœƒä¸Ÿå¤±
                    answers.value[currentQuestionIndex.value] = [...selectedOptions.value];

                    // if (isCorrect.value) score.value++;
                    // ï¼ˆä½ è‹¥æƒ³ã€Œå³æ™‚åŠ åˆ†ã€ï¼Œå¯ä»¥ç•™é€™è¡Œï¼‰
                }


                // å–®é¸é¡Œï¼šåªå…è¨±ä¸€å€‹å‹¾é¸
                watch(() => selectedOptions.value, (newVal) => {
                    if (currentQuestion.value && currentQuestion.value.correct_answer.length === 1) {
                        if (newVal.length > 1) {
                            selectedOptions.value = [newVal[newVal.length - 1]];
                        }
                    }
                });

                // ---------- ä¸‹ä¸€é¡Œ ----------
                function nextQuestion() {
                    // å…ˆæª¢æŸ¥æ˜¯å¦æœ‰é¸æ“‡
                    if (selectedOptions.value.length === 0) {
                        alert("è«‹å…ˆé¸ç­”æ¡ˆå¾Œå†é€²å…¥ä¸‹ä¸€é¡Œï¼");
                        return;
                    }

                    // è‹¥æ­¤é¡Œæ˜¯è¤‡é¸é¡Œ(>1)ï¼Œæª¢æŸ¥è‡³å°‘ 2 å€‹
                    const correctCount = currentQuestion.value.correct_answer.length;
                    if (correctCount > 1 && selectedOptions.value.length < 2) {
                        alert("æ­¤é¡Œç‚ºè¤‡é¸é¡Œï¼Œè«‹è‡³å°‘é¸æ“‡å…©å€‹é¸é …å†é€²å…¥ä¸‹ä¸€é¡Œï¼");
                        return;
                    }

                    // **é‡é»ï¼šå³ä½¿æ²’æŒ‰ã€Œç¢ºèªç­”æ¡ˆã€ï¼Œä¹ŸæŠŠé¸æ“‡å¯«å…¥ answers[]**
                    answers.value[currentQuestionIndex.value] = [...selectedOptions.value];

                    // ç„¶å¾Œå†é€²è¡Œã€Œä¸‹ä¸€é¡Œã€é‚è¼¯
                    if (currentQuestionIndex.value < questions.value.length - 1) {
                        currentQuestionIndex.value++;
                        currentQuestion.value = questions.value[currentQuestionIndex.value];
                        // é‡ç½®
                        showResult.value = false;
                        answerSubmitted.value = false;
                        // å›å¾©ä¹‹å‰å‹¾é¸çš„é¸é …ï¼ˆè‹¥æœ‰ï¼‰
                        selectedOptions.value = answers.value[currentQuestionIndex.value] || [];
                    } else {
                        // æ²’é¡Œç›®äº† â†’ çµæŸæ¸¬é©—
                        currentQuestion.value = null;
                    }
                }

                // ---------- ä¸Šä¸€é¡Œ ----------
                function goBack() {
                    if (currentQuestionIndex.value > 0) {
                        currentQuestionIndex.value--;
                        currentQuestion.value = questions.value[currentQuestionIndex.value];
                        showResult.value = false;
                        answerSubmitted.value = false;
                        selectedOptions.value = answers.value[currentQuestionIndex.value] || [];
                    }
                }

                // ---------- äº¤å· ----------
                function jumpToResult() {
                    // æŠŠç•¶å‰é¡Œç›®é¸æ“‡ä¹Ÿå­˜é€² answers
                    answers.value[currentQuestionIndex.value] = [...selectedOptions.value];

                    wrongAnswers.value = [];
                    let finalScore = 0;

                    // åªéæ­·ä½¿ç”¨è€…ã€ŒçœŸçš„æœ‰å¡«å¯«ã€çš„é¡Œç›® index
                    for (let i = 0; i < answers.value.length; i++) {
                        // è‹¥è©²é¡Œæ²’æœ‰ä»»ä½•é¸æ“‡ï¼Œå°±ç›´æ¥è·³éï¼Œä¸è¨ˆå…¥å°éŒ¯
                        if (!answers.value[i] || answers.value[i].length === 0) {
                            continue;
                        }

                        const userSelect = answers.value[i];
                        const correct = questions.value[i].correct_answer;
                        const isCorrect = correct.every(opt => userSelect.includes(opt)) &&
                            userSelect.every(opt => correct.includes(opt));

                        if (isCorrect) {
                            finalScore++;
                        } else {
                            wrongAnswers.value.push({
                                question_number: questions.value[i].question_number,
                                question: questions.value[i].question,
                                options: questions.value[i].options,
                                selected: [...userSelect],
                                correct
                            });
                        }
                    }

                    score.value = finalScore;
                    currentQuestion.value = null; // é¡¯ç¤ºã€Œæ¸¬é©—çµæŸã€
                }



                // ---------- é‡æ–°é–‹å§‹ ----------
                function restartExam() {
                    score.value = 0;
                    currentQuestionIndex.value = 0;
                    sectionSelected.value = false;
                    wrongAnswers.value = [];
                    answers.value = []; // æ¸…ç©ºä½¿ç”¨è€…æœ€çµ‚é¸æ“‡
                    currentPage.value = 0;
                }

                // ---------- æœå°‹ ----------
                function searchQuestion() {
                    if (searchQuery.value.length < 5) return;
                    fetch('questions.json')
                        .then(response => response.json())
                        .then(allQuestions => {
                            searchResults.value = allQuestions.filter(q =>
                                q.question.includes(searchQuery.value)
                            );
                        });
                }

                // ---------- éŒ¯èª¤é¡Œç›®åˆ†é  ----------
                const pagedWrongAnswers = computed(() => {
                    const start = currentPage.value * itemsPerPage;
                    const end = start + itemsPerPage;
                    return wrongAnswers.value.slice(start, end);
                });
                const showPrevButton = computed(() => currentPage.value > 0);
                const showNextButton = computed(() => {
                    const totalPages = Math.ceil(wrongAnswers.value.length / itemsPerPage);
                    return currentPage.value < totalPages - 1;
                });
                function nextPage() {
                    currentPage.value++;
                }
                function prevPage() {
                    currentPage.value--;
                }

                // ---------- ä¸‹è¼‰ JSON ----------
                function downloadJson() {
                    const link = document.createElement('a');
                    link.href = 'questions.json';
                    link.download = 'questions.json';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }

                // ---------- onMounted ----------
                onMounted(loadQuestions);

                return {
                    // ç‹€æ…‹
                    questions,
                    currentQuestion,
                    selectedOptions,
                    showResult,
                    isCorrect,
                    score,
                    sectionSelected,
                    searchQuery,
                    searchResult,
                    searchResults,
                    wrongAnswers,
                    answerSubmitted,
                    currentQuestionIndex,
                    currentPage,
                    showAnswer,
                    shuffleQuestions,

                    // å‡½å¼
                    changeSection,
                    submitAnswer,
                    nextQuestion,
                    goBack,
                    jumpToResult,
                    restartExam,
                    searchQuestion,
                    downloadJson,
                    prevPage,
                    nextPage,
                    loadQuestions,
                    // è¨ˆç®—å±¬æ€§
                    pagedWrongAnswers,
                    showPrevButton,
                    showNextButton
                };
            }
        }).mount("#app");
    </script>

</body>

</html>